<% javascript_response do %>
  (function(){
    <% if higher_item = @task.higher_item %>
      var content = "<%= raw escape_javascript(render @task) %>",
          before  = $("task_<%= @task.higher_item.id %>");
      if (before){
        before.insert({after: content});
      } else {
        $("new_task").insert({before: content});
      }
    <% else %>
      $("tasks").insert({top: "<%= raw escape_javascript(render @task) %>"});
    <% end %>
    $("task_<%= @task.id %>").hide().slideDown(function(e){
      new Taskar.FX.ScrollTo(e.element);
    });
    Taskar.Sections.resetTaskForm($('new_task').down('form').show(), '<%= @task.id %>')
  })();
<% end %>